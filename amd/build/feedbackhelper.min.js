define(["jquery","core/log","assignfeedback_cloudpoodll/cloudpoodllloader","core/str"],function(a,b,c,d){"use strict";return b.debug("cloudpoodll feedback helper: initialising"),{uploadstate:!1,togglestate:0,strings:{},init:function(a){this.component=a.component,this.register_controls(),this.register_events(),this.setup_recorder()},setup_recorder:function(){var a=this,b=function(b){switch(b.type){case"recording":"started"===b.action&&a.controls.updatecontrol.val();break;case"awaitingprocessing":"posted"!=a.uploadstate&&a.controls.updatecontrol.val(b.mediaurl),a.uploadstate="posted";break;case"error":alert("PROBLEM:"+b.message)}};this.uploadstate=!1,c.init(this.component+"_therecorder",b)},register_controls:function(){var b=this;this.controls={},this.controls.deletebutton=a("."+this.component+"_deletefeedbackbutton"),this.controls.updatecontrol=a("#"+this.component+"_updatecontrol"),this.controls.currentcontainer=a("."+this.component+"_currentfeedback"),this.controls.togglecontainer=a("."+this.component+"_togglecontainer"),this.controls.togglebutton=a("."+this.component+"_togglecontainer .togglebutton"),this.controls.toggletext=a("."+this.component+"_togglecontainer .toggletext"),d.get_string("clicktohide",b.component).done(function(a){b.strings.clicktohide=a}),d.get_string("clicktoshow",b.component).done(function(a){b.strings.clicktoshow=a})},register_events:function(){var a=this;this.controls.deletebutton.click(function(){a.controls.updatecontrol&&confirm(M.util.get_string("reallydeletefeedback",a.component))&&(a.controls.updatecontrol.val(-1),a.controls.currentcontainer.html(""))}),this.controls.togglebutton.click(function(){a.toggle_currentfeedback(a)}),this.controls.toggletext.click(function(){a.toggle_currentfeedback(a)})},toggle_currentfeedback:function(a){var b=function(){0==a.togglestate?(a.controls.togglebutton.removeClass("fa-toggle-off"),a.controls.togglebutton.addClass("fa-toggle-on"),a.controls.toggletext.text(a.strings.clicktohide),a.togglestate=1):(a.controls.togglebutton.removeClass("fa-toggle-on"),a.controls.togglebutton.addClass("fa-toggle-off"),a.controls.toggletext.text(a.strings.clicktoshow),a.togglestate=0)};return a.controls.currentcontainer.toggle({duration:300,complete:b}),!1}}});